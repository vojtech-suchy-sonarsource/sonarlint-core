/*
ACR-f3d03c87c0b440cdb55ff0115bd8e20f
ACR-dbdc7d5e8e754a60a745b720d855b277
ACR-3cf4a43507f14ebd9eb32bd4fb1e3812
ACR-dda362ee64404518bd2ea0dbb33e7b20
ACR-67649a9c572b4ceb9482cf882bdd231f
ACR-4928048873ea4d7fb39f2a7535064bc8
ACR-cc335e8828e845e996af5505f6e40d0f
ACR-2e379155ddcc41888a712c24ea462c5c
ACR-156b4645a7e44638900ab768dab25303
ACR-fad4feb4c1e84b84b10daa6630a1ffc5
ACR-c1ffa6ad668a42d3848a4c7f2acb3a48
ACR-52c56dbcab8e42beb1f350b57971c158
ACR-5ce2b37c03ea4a8f8c49f792de19af39
ACR-01b11a3e7a5d433ca918ac4bcae9660f
ACR-3b799d2b4b314595a8d6f4f5f933b525
ACR-12dda3e276054166967e6b52bcc915a6
ACR-92ab5c61d9f245f0817f872e2cc014a2
 */
package org.sonarsource.sonarlint.core.serverapi.push.parsing;

import com.google.gson.Gson;
import java.util.Optional;
import org.sonarsource.sonarlint.core.commons.log.SonarLintLogger;
import org.sonarsource.sonarlint.core.serverapi.push.TaintVulnerabilityClosedEvent;

import static org.sonarsource.sonarlint.core.serverapi.util.ServerApiUtils.isBlank;

public class TaintVulnerabilityClosedEventParser implements EventParser<TaintVulnerabilityClosedEvent> {
  private static final SonarLintLogger LOG = SonarLintLogger.get();

  private final Gson gson = new Gson();

  @Override
  public Optional<TaintVulnerabilityClosedEvent> parse(String jsonData) {
    var payload = gson.fromJson(jsonData, TaintVulnerabilityClosedEventPayload.class);
    if (payload.isInvalid()) {
      LOG.error("Invalid payload for 'TaintVulnerabilityClosed' event: {}", jsonData);
      return Optional.empty();
    }
    return Optional.of(new TaintVulnerabilityClosedEvent(payload.projectKey, payload.key));
  }

  private static class TaintVulnerabilityClosedEventPayload {
    private String projectKey;
    private String key;

    private boolean isInvalid() {
      return isBlank(projectKey) || isBlank(key);
    }

  }
}
