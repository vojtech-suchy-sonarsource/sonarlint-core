/*
ACR-1c1f15fe1660429d96a41c147901959b
ACR-f85ac2638e874fa48efcfc979df9b072
ACR-2af1f0aaa7b34cb182a15187ffdbcd35
ACR-53ea75bfadff4df9b2bc2948818261d7
ACR-92db83b2e5a04103934d00fc5afad348
ACR-f11f0619e1a54edba503e43ffc7277ad
ACR-3be202dc42c04791bf25233561617ad6
ACR-7b0b97d6f46c4caea8b77e8306eba8b5
ACR-0572fe5858aa4b3ba893c3135e17818b
ACR-f1aa60d1986a42eca8a159d7e6dd7875
ACR-63f7199661de4dbfaff121b8f519e31f
ACR-0c8d7260d8fe4aa8bc255be9cf513f13
ACR-eff217234f904a01b75dd12035fa8e27
ACR-2ccf1035521849b7b8ff0925d281dc5c
ACR-f8c3c80962af4989ae8937cd9a0d64e0
ACR-0ead249736c14ea2b8d5efce9046bb57
ACR-dc405d4278254ea1b68b900152b7eaec
 */
package org.sonarsource.sonarlint.core.serverapi.push.parsing;

import com.google.gson.Gson;
import java.util.Optional;
import org.sonarsource.sonarlint.core.commons.log.SonarLintLogger;
import org.sonarsource.sonarlint.core.serverapi.push.TaintVulnerabilityClosedEvent;

import static org.sonarsource.sonarlint.core.serverapi.util.ServerApiUtils.isBlank;

public class TaintVulnerabilityClosedEventParser implements EventParser<TaintVulnerabilityClosedEvent> {
  private static final SonarLintLogger LOG = SonarLintLogger.get();

  private final Gson gson = new Gson();

  @Override
  public Optional<TaintVulnerabilityClosedEvent> parse(String jsonData) {
    var payload = gson.fromJson(jsonData, TaintVulnerabilityClosedEventPayload.class);
    if (payload.isInvalid()) {
      LOG.error("Invalid payload for 'TaintVulnerabilityClosed' event: {}", jsonData);
      return Optional.empty();
    }
    return Optional.of(new TaintVulnerabilityClosedEvent(payload.projectKey, payload.key));
  }

  private static class TaintVulnerabilityClosedEventPayload {
    private String projectKey;
    private String key;

    private boolean isInvalid() {
      return isBlank(projectKey) || isBlank(key);
    }

  }
}
